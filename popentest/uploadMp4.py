import time
import sys
import json
import redis
#from testlib import MyObsClient

def uploadMp4File(path):
    print("upload file")
    print(path)
    endpoint = "http://gqjt.com"
    bucket = "x8v-drivingcloud-xtest"
    ak = "CB350C40B87AA1F98EC4"
    sk = "po31sdnqhaYU6xV3Y2daLNHruxMAAAGEuHqh+fPl"
    #client = MyObsClient(sk=sk, ak=ak, server=endpoint)
    obsKey = "matlab"
    #client.put_file(bucket, obsKey, path)

# json
def mp4ValStr( path, mile, xosc_id):
    dict_data = {}
    dict_data['mp4path'] = path
    dict_data['mile'] = mile
    dict_data['xosc_id'] = xosc_id
    dict_data_str = json.dumps(dict_data)
    return dict_data_str

def insertRecordToRedis(path, mile, xosc_id):
    print("insert record to redis")
    data = mp4ValStr(path, mile, xosc_id)
    print(data)
    #redisapp = redis.ConnectionPool('127.0.0.1',6379,password='123456',decode_responses=True)
    #redishandle = redis.Redis(connection_pool=redisapp)
    redishandle = redis.Redis(host='127.0.0.1',port=6379,password='123456')
    tablename = "mp4Info_uuid"
    redishandle.lpush("mp4Info_uuid", data)

if __name__ == "__main__":
    print(sys.argv[1:])
    ab = sys.argv[1:]
    length = len(ab)
    print(length)

    if length == 3:
        uploadMp4File(sys.argv[1])
        insertRecordToRedis(sys.argv[1],sys.argv[2],sys.argv[3])
        
    sys.exit(0)


